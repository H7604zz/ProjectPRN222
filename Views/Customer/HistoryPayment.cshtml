@model List<ProjectPrn222.Models.DTO.OrderViewModel>

@{
    ViewData["Title"] = "Lịch Sử Giao Dịch";
}

<h2 class="text-center">Lịch Sử Giao Dịch</h2>

<div class="accordion container" id="orderAccordion">
    @if (Model != null && Model.Any())
    {
        @foreach (var order in Model.GroupBy(o => o.OrderId))
        {
            var orderId = order.Key; // Mã đơn hàng
            var firstOrder = order.First(); // Lấy thông tin đơn hàng

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading-@orderId">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-@orderId" aria-expanded="false" aria-controls="collapse-@orderId">
                        <strong>Đơn hàng #@orderId</strong> - Ngày: @firstOrder.OrderDate.ToString("dd/MM/yyyy") - Thành tiền: <span class="text-danger">@firstOrder.FinalTotal.ToString("N0") đ</span>
                    </button>
                </h2>
                <div id="collapse-@orderId" class="accordion-collapse collapse" aria-labelledby="heading-@orderId" data-bs-parent="#orderAccordion">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Hình Ảnh</th>
                                    <th>Tên Sản Phẩm</th>
                                    <th>Số lượng</th>
                                    <th>Giá</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in order)
                                {
                                    <tr>
                                        <td><img src="@item.ProductImage" alt="Ảnh sản phẩm" style="width: 50px; height: 50px;"></td>
                                        <td>@item.ProductName</td>
                                        <td>@item.Quantity</td>
                                        <td>@item.CurrentPrice.ToString("N0") VNĐ</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                        <div class="text-end">
                            <p><strong>Tổng tiền: </strong> @firstOrder.TotalAmount.ToString("N0") VNĐ</p>
                            <p><strong>Giảm giá: </strong> @firstOrder.DiscountAmount.ToString("N0") VNĐ</p>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <div style="height: 400px">
            <p class="text-center text-muted">Bạn chưa có VNĐơn hàng nào.</p>
        </div>
    }
</div>
